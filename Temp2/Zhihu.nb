(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[      9527,        236]
NotebookOptionsPosition[      9191,        220]
NotebookOutlinePosition[      9548,        236]
CellTagsIndexPosition[      9505,        233]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{
  RowBox[{"MyName", "=", "\"\<GalAster\>\""}], ";", 
  RowBox[{"(*", "\:586b\:4f60\:7684ID\:540d", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
  "MyCookie", "=", 
   "\"\<udid=\\\"ACCAC_nyoAmPTlJfJrOHmwR61S7XW-0okjU=|1458199934\\\"; \
_za=d3121aa3-dbcf-4c05-9caa-1787b571e838; \
_xsrf=f3d25af737efdf1a812f45b5c7f38bdb; \
_zap=09ee5ac8-3ccf-43e4-bdfe-3c8c942bbfc9; \
d_c0=\\\"AIBALyBGoQmPTrBduzR0kqJHxhpSz-LU5Ig=|1460859438\\\"; \
_ga=GA1.2.880081923.1476201145; aliyungf_tc=AQAAAP3hbXAa2AYA5RLfPEgSTTiopOuO; \
q_c1=12f6fdd06f3c47208e15c4f1bd54ddc6|1483930918000|1465310302000; \
__utma=51854390.2554402.1484095884.1484110979.1484110979.3; __utmc=51854390; \
__utmz=51854390.1484063825.1.1.utmcsr=so.com|utmccn=(organic)|utmcmd=organic|\
utmctr=bilibili%20appkey; \
__utmv=51854390.100-1|2=registration_date=20150221=1^3=entry_date=20150221=1; \
s-q=%E7%9F%B3%E5%A4%B4%E5%89%AA%E5%88%80%E5%B8%83%20%E5%89%AA%E5%88%80%E7%9F%\
B3%E5%A4%B4%E5%B8%83; s-i=4; sid=b3c8kkah; s-t=autocomplete; \
r_cap_id=\\\"YWY4MDE1MTJmZDczNDc4ZDlhMzE0OWZmNzZiZDYwZDE=|1484297534|\
9f6cd39ac282958ab53b79e6fd90e49b98c7f12e\\\"; \
l_cap_id=\\\"YWVmMTJhNzAyODkwNDk5YWE0NTIxMmJmYTFhNTE0MmQ=|1484300779|\
09092a6248dd2d65a63b3af38ff82a79f8c80737\\\"; \
cap_id=\\\"ZDY2MTY4MDIzMzRlNGQxNjljM2U2ZmRjMDk4ZDg0NTg=|1484300779|\
5e7ac392805a954fae831d7d1ca7dcf8fb807e43\\\"; n_c=1; \
z_c0=Mi4wQUFDQmVIM0lxZ2NBZ0VBdklFYWhDUmNBQUFCaEFsVk44QzZnV0FDcXZBYXIxMlcwdkVIa\
G41dnlvd2RaMUViTDJn|1484303211|4b29fe495990093985d72221100adaaeea9e47f7\>\""}]\
, ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"head", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"\"\<Host\>\"", "\[Rule]", "\"\<www.zhihu.com\>\""}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
     "\"\<Accept\>\"", "\[Rule]", 
      "\"\<text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/\
*;q=0.8\>\""}], ",", "\[IndentingNewLine]", 
     RowBox[{
     "\"\<User-Agent\>\"", "\[Rule]", 
      "\"\<Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, \
like Gecko) Chrome/50.0.2661.102 Safari/537.36\>\""}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"\"\<Referer\>\"", "\[Rule]", "\"\<https://www.zhihu.com/\>\""}],
      ",", "\[IndentingNewLine]", 
     RowBox[{"\"\<Accept-Encoding\>\"", "\[Rule]", "\"\<deflate,sdch\>\""}], 
     ",", 
     RowBox[{
     "(*", "\:544a\:8bc9gzip\:8ba9\:4ed6\:5377\:94fa\:76d6\:56de\:5bb6", 
      "*)"}], "\[IndentingNewLine]", 
     RowBox[{"\"\<Cookie\>\"", "\[Rule]", "MyCookie"}]}], "}"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.693292092868771*^9, 3.6932920983942533`*^9}, {
   3.6932922165055237`*^9, 3.6932922399479356`*^9}, {3.6932947246420126`*^9, 
   3.6932947486692057`*^9}, {3.6932947794207816`*^9, 3.693294785621899*^9}, {
   3.6932948203653593`*^9, 3.693294832694683*^9}, {3.69329487464785*^9, 
   3.6932948754963818`*^9}, 3.6932949865225163`*^9, {3.693295044520894*^9, 
   3.6932950659527035`*^9}, 3.693295207108467*^9, {3.693295283255849*^9, 
   3.6932953141397033`*^9}, {3.693295416271817*^9, 3.6932954483109465`*^9}, {
   3.6932963177503214`*^9, 3.693296360056162*^9}, {3.6932966839527426`*^9, 
   3.693296688546217*^9}, {3.6932967998455687`*^9, 3.6932968114051757`*^9}, {
   3.6932969603933835`*^9, 3.693296976668747*^9}, {3.6932977934480696`*^9, 
   3.6932978402216125`*^9}, {3.6932980713705664`*^9, 3.693298071696594*^9}, {
   3.6932986195487056`*^9, 3.6932986197484555`*^9}, {3.693299223036992*^9, 
   3.6932992360426807`*^9}, {3.693299278144672*^9, 3.6932992913954535`*^9}, 
   3.6933008911815224`*^9, {3.6933010917018213`*^9, 3.6933010944362574`*^9}, {
   3.6933011892545357`*^9, 3.6933011895188274`*^9}, 3.693301418933569*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"FollowPage", "[", 
   RowBox[{"UserName_", ",", "Type_", ",", "Page_"}], "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"Import", "[", 
   RowBox[{
    RowBox[{"URLRead", "[", 
     RowBox[{"\[LeftAssociation]", 
      RowBox[{
       RowBox[{"\"\<Scheme\>\"", "\[Rule]", "\"\<https\>\""}], ",", 
       RowBox[{"\"\<Domain\>\"", "\[Rule]", "\"\<www.zhihu.com\>\""}], ",", 
       RowBox[{"\"\<Headers\>\"", "->", "head"}], ",", "\[IndentingNewLine]", 
       RowBox[{"\"\<Path\>\"", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
         "\"\<\>\"", ",", "\"\<people\>\"", ",", "UserName", ",", "Type"}], 
         "}"}]}], ",", 
       RowBox[{"\"\<Query\>\"", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"\"\<page\>\"", "\[Rule]", 
          RowBox[{"ToString", "[", "Page", "]"}]}], "}"}]}]}], 
      "\[RightAssociation]"}], "]"}], ",", "\"\<Source\>\""}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"PageNumbers", "[", 
   RowBox[{"UserName_", ",", "Type_"}], "]"}], ":=", 
  RowBox[{"Last", "@", 
   RowBox[{"StringCases", "[", 
    RowBox[{
     RowBox[{"FollowPage", "[", 
      RowBox[{"UserName", ",", "Type", ",", "Nothing"}], "]"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
     "RegularExpression", "[", "\"\<(?<=\\\"button\\\">)\\\\d{1,}\>\"", 
      "]"}]}], "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"UserDataRaw", "=", 
   RowBox[{
    RowBox[{"ToExpression", "@", 
     RowBox[{"StringCases", "[", 
      RowBox[{
       RowBox[{"FollowPage", "[", 
        RowBox[{"#", ",", "\"\<following\>\"", ",", "Nothing"}], "]"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
       "RegularExpression", "[", 
        "\"\<(?<=value\\\">)\\\\d{1,}|\\\\d{1,}(?= \:6b21)\>\"", "]"}]}], 
      "]"}]}], "&"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"User\:5c5e\:6027", "=", 
   RowBox[{"{", 
    RowBox[{
    "\"\<ID\>\"", ",", "\"\<\:83b7\:8d5e\:6570\>\"", ",", 
     "\"\<\:83b7\:611f\:8c22\>\"", ",", "\"\<\:83b7\:6536\:85cf\>\"", ",", 
     "\"\<\:7f16\:8f91\:6570\>\"", ",", "\"\<\:5173\:6ce8\:6570\>\"", ",", 
     "\"\<\:5173\:6ce8\:8005\>\""}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"UserData", "=", 
   RowBox[{
    RowBox[{"Rule", "@@@", 
     RowBox[{"Transpose", "@", 
      RowBox[{"{", 
       RowBox[{"User\:5c5e\:6027", ",", 
        RowBox[{"Prepend", "[", 
         RowBox[{
          RowBox[{"Take", "[", 
           RowBox[{
            RowBox[{"UserDataRaw", "[", "#", "]"}], ",", "6"}], "]"}], ",", 
          "#"}], "]"}]}], "}"}]}]}], "&"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.6933012582780466`*^9, 3.693301261808937*^9}, {
  3.693301579112279*^9, 3.6933015886752377`*^9}, {3.693301618809429*^9, 
  3.69330163859628*^9}, {3.6933017517827077`*^9, 3.693301774519023*^9}, {
  3.6933021884818363`*^9, 3.6933022104636793`*^9}, {3.693304104098159*^9, 
  3.6933041043744764`*^9}, {3.6933452828775034`*^9, 3.693345316789198*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"GetAnswers", "[", 
    RowBox[{"ID_", ",", 
     RowBox[{"Offset_:", "0"}]}], "]"}], ":=", 
   RowBox[{"Import", "[", 
    RowBox[{
     RowBox[{"\"\<https://www.zhihu.com/api/v4/questions/\>\"", "<>", 
      RowBox[{"ToString", "[", "ID", "]"}], "\[IndentingNewLine]", "<>", 
      "\"\</answers?limit=20\>\"", "<>", "\"\<&offset=\>\"", "<>", 
      RowBox[{"ToString", "[", "Offset", "]"}]}], ",", "\"\<json\>\""}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"RawAnswers", "[", "ID_", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"try", "=", 
        RowBox[{"GetAnswers", "[", "ID", "]"}]}], ",", "all"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"total", "=", 
           RowBox[{"\"\<totals\>\"", "/.", "\[VeryThinSpace]", 
            RowBox[{"(", 
             RowBox[{"\"\<paging\>\"", "/.", "try"}], ")"}]}]}], ")"}], 
         "\[LessEqual]", "20"}], ",", 
        RowBox[{"Return", "[", "try", "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"all", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"GetAnswers", "[", 
          RowBox[{"ID", ",", "#"}], "]"}], "&"}], "/@", 
        RowBox[{"(", 
         RowBox[{"20", 
          RowBox[{"Range", "[", 
           RowBox[{"1", ",", 
            RowBox[{"Quotient", "[", 
             RowBox[{"total", ",", "20"}], "]"}]}], "]"}]}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Flatten", "[", 
       RowBox[{
        RowBox[{"\"\<data\>\"", "/.", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"{", "try", "}"}], "~", "Join", "~", "all"}], ")"}]}], ",",
         "1"}], "]"}]}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"RawAnswers", "[", "22595716", "]"}]}], "Input"]
},
WindowSize->{861, 733},
WindowMargins->{{278, Automatic}, {Automatic, 84}},
FrontEndVersion->"11.0 for Microsoft Windows (64-bit) (2016\:5e7410\:67088\
\:65e5)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 3683, 66, 548, "Input"],
Cell[4244, 88, 2989, 74, 318, "Input"],
Cell[7236, 164, 1951, 54, 253, "Input"]
}
]
*)

